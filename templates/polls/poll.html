{% extends "includes/base.html" %}
{% load temps %}

{% block title %}{{ poll.title }}{% endblock %}
{% block content %}
<h1>{{ poll.game }}/{{ poll.title }}</h1>
<hr>
<table width=100%>
<tr>
<td>
<p>
<table class="longturn" width=400>
<tr>
	<th>title</th>
	<td>
	{% if not poll.valid %}<strike>{% endif %}
	{% if poll.has_ended %}
	{{ poll.title }} <b>(ended)</b>
	{% else %}
	{{ poll.title }}
	{% endif %}
	{% if not poll.valid %}</strike>{% endif %}
	</td>
</tr>
{% if not poll.valid %}
<tr>
	<th>validity</th>
	<td>{% if poll.valid %}valid{% else %}invalid{% endif %}</td>
</tr>
{% endif %}
{% if poll.game %}
<tr>
	<th>game</th>
	<td><a href="{% url game poll.game %}">{{ poll.game }}</a></td>
</tr>
{% endif %}
<tr>
	<th>forum thread</th>
	{% if poll.subject %}
	<td><a href="http://forum.longturn.org/viewtopic.php?id={{ poll.topic_id }}">{{ poll.subject }}</a></td>
	{% else %}
	<td>-</td>
	{% endif %}
</tr>
<tr>
	<th>posted by</th>
	<td><a href="{% url profile poll.author %}">{{ poll.author }}</a></td>
</tr>
<tr>
	<th>published</th>
	<td>{{ poll.pub_date|date:"d.m.Y, H:i:s" }}</td>
</tr>
<tr>
	<th>ends</th>
	<td>{{ poll.end_date|date:"d.m.Y, H:i:s" }}</td>
</tr>
</table>
</p>
<p>
<table class="longturn" width=400>
<th width=80>for</th>
<th width=80>against</th>
<th width=80>withheld</th>
<th width=80>votes</th>
<th width=80>eligible</th>
<tr>
<td>{{ vcnt.For }}</td>
<td>{{ vcnt.Against }}</td>
<td>{{ vcnt.Withhold }}</td>
<td><b>{{ total }}</b></td>
<td>{{ eligible }}</td>
</tr>
</table>
</p>
</td>
<td>
{% if poll.has_ended %}
<fieldset style="width: 200">
<legend>vote</legend>
<form action="" method="post">{% csrf_token %}
	<table>
		{{ form.as_table }}
	</table>
	<center>
	<input class="button" type="submit" name="submit" value="vote" disabled>
	</center>
</form>
</fieldset>
{% else %}
{% if user.is_authenticated %}
<fieldset style="width: 200">
<legend>vote</legend>
<form action="" method="post">{% csrf_token %}
	<table>
		{{ form.as_table }}
	</table>
	<center>
	<input class="button" type="submit" name="submit" value="vote">
	</center>
</form>
</fieldset>
{% else %}
log in to vote.
{% endif %}
{% endif %}
</td>
</table>
<hr>
{% autoescape off %}
{{ poll.description|sanitize }}
{% endautoescape %}
<hr>


{% if diff != None %}
<h2>diff</h2>
<p>
<a href="{{ MEDIA_URL }}{{ diff }}">download</a>
</p>
<p>
<fieldset style="width: 660">
<legend>diff</legend>
<div class="codebox">
<pre>
{{ diff_text }}
</pre>
</div>
</fieldset>
</p>
<hr>
{% endif %}

{% endblock %}
